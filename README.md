# Bitrix docker-compose

Настроенная обертка над docker-compose для проектов bitrix

Установка:

```bash
composer require beeralex/compose:dev-main
```

## Установка docker-compose.yml

Команды выполнять в директории где находится composer.json!!!

Для установки docker-compose.yml выполнить команду

```bash
./vendor/bin/compose install
```

Или можно создать алиас

```bash
alias compose='sh $([ -f compose ] && echo compose || echo vendor/bin/compose)'
```

Тогда команда install будет выполняться слудующим образом:

```bash
compose install
```

Шаги установки:

- `1` - Путь до директории сайта указывается относительно текущей директории (./). Можно оставить пустым и вмонтироваться в контейнеры будет все из текущей директории. Или если используете composer.bx в директории ./bitrix, то нужно задать такой путь - ./../ а команды выполнять в ./bitrix
- `2` - Выбрать версию php - 7.4 или 8.2
- `3` - Выбрать версию mysql - 5.7 или 8.0
- `4` - Устанавливать ли node.js - Y или N, если установите Y, то будет создан сервис с node js 20 версии
- `4.1` - Если будет устанавливаться node.js, то нужно указать корневую директорию для него, то есть директория содержащая файл package.json. Путь указывается относительно корня сайта - locac/js/vite или пустое поле если package.json в корне сайта.


После этого в директории где выполнялась команда появиться docker-compose.yml файл с настроенными сервисами.

## Публикация докерфайлов и файлов конфигурации

По умолчанию это все (докерфайлы, php.ini, nginx.conf и т.д.) находится в ядре пакета, поэтому если вам необходимо внести изменения в докерфайлы или файлы конфигурации, или добавить что то свое, то используйте команду:

```bash
compose publish
```

Эта команда перенесет всю конфигурацию в корень сайта (директория _docker) и изменит пути до файлов в docker-compose.yml, т.к. теперь все будет браться из ./_docker

## Описание всех доступных команд

- `install` - Создание docker-compose.yml в текущей директории
- `publish` - Публикация файлов конфигурации в текущей директории
- `php` - Выполнение команды php в контейнере с php (compose php -v)
- `composer` - Выполнение команды composer в контейнере с php (compose composer install)
- `npm` - Выполнение команды npm в контейнере с node js если он был установлен (compose npm install)
- `И все дефолтные команды docker-compose` - Выполнение любой команды docker-compose (compose up -d, compose down, compose build и т.д.)
